<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Quest - Pixel Platformer</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crt-effect {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 4px 100%;
            pointer-events: none;
            z-index: 999;
        }

        .title-screen {
            position: absolute;
            text-align: center;
            color: #fff;
            z-index: 1000;
            text-shadow: 4px 4px #000;
        }

        .pixel-button {
            background: #4a4a4a;
            border: 4px solid #2a2a2a;
            color: #fff;
            padding: 15px 30px;
            font-size: 24px;
            margin: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Press Start 2P', cursive;
        }

        .pixel-button:hover {
            background: #6a6a6a;
            transform: scale(1.1);
        }

        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #fff;
            font-size: 24px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border: 4px solid #2a2a2a;
        }
        
        .game-over {
            position: absolute;
            color: #ff0000;
            font-size: 64px;
            text-shadow: 6px 6px #000;
            z-index: 1001;
            display: none;
        }
        
        .powerup-hud {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #ffeb3b;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="crt-effect"></div>
        <div class="hud" id="hud">Coins: 0 | Lives: ❤❤❤ | Level: 1</div>
        <div class="powerup-hud" id="powerupHud"></div>
        <div class="title-screen" id="titleScreen">
            <h1 style="font-size: 48px; margin-bottom: 40px;">RETRO QUEST</h1>
            <button class="pixel-button" onclick="startGame()">START ADVENTURE</button>
            <p style="margin-top: 30px; font-size: 16px;">Use ← → to move | SPACE to jump</p>
        </div>
        <div class="game-over" id="gameOver">GAME OVER!</div>
    </div>

<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#1a1a1a',
    parent: 'game-container',
    pixelArt: true,
    scene: {
        preload: preload,
        create: create,
        update: update
    },
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 800 },
            debug: false
        }
    }
};

let game = new Phaser.Game(config);
let player, cursors, coins, enemies, powerups;
let score = 0, lives = 3, currentLevel = 1, isInvincible = false;
const LEVELS = ['level1', 'level2', 'level3'];

function preload() {
    this.load.audio('bgm', 'https://assets.codepen.io/439000/chiptune.mp3');
    this.load.spritesheet('enemy', 'https://assets.codepen.io/439000/pixel_enemy.png', { frameWidth: 32 });
    this.load.image('powerup', 'https://assets.codepen.io/439000/pixel_powerup.png');
    this.load.image('bg1', 'https://assets.codepen.io/439000/parallax_bg1.png');
    this.load.image('bg2', 'https://assets.codepen.io/439000/parallax_bg2.png');
    this.load.image('tiles', 'https://assets.codepen.io/439000/platformer_tiles.png');
    this.load.tilemapTiledJSON('map', 'https://gist.githubusercontent.com/phantomd/.../level1.json');
    this.load.spritesheet('player', 'https://assets.codepen.io/439000/pixel_player.png', {
        frameWidth: 32,
        frameHeight: 32
    });
    this.load.image('coin', 'https://assets.codepen.io/439000/pixel_coin.png');
}

function create() {
    // Tilemap setup
    const map = this.make.tilemap({ key: 'map' });
    const tileset = map.addTilesetImage('platformer_tiles', 'tiles');
    const platformLayer = map.createLayer('platforms', tileset);
    platformLayer.setCollisionByProperty({ collides: true });

    // Player setup
    player = this.physics.add.sprite(100, 450, 'player');
    player.setCollideWorldBounds(true);
    
    // Animations
    this.anims.create({
        key: 'run',
        frames: this.anims.generateFrameNumbers('player', { start: 4, end: 7 }),
        frameRate: 10,
        repeat: -1
    });

    // Coins setup
    coins = this.physics.add.group();
    map.getObjectLayer('coins').objects.forEach(coin => {
        coins.create(coin.x, coin.y, 'coin').setScale(0.5);
    });

    // Camera setup
    this.cameras.main.startFollow(player);
    this.cameras.main.setBounds(0, 0, map.widthInPixels, map.heightInPixels);

    // Controls
    cursors = this.input.keyboard.createCursorKeys();

    // Add parallax backgrounds
    this.bg1 = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'bg1')
        .setScrollFactor(0.2);
    this.bg2 = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'bg2')
        .setScrollFactor(0.5);

    // Add sound
    this.bgm = this.sound.add('bgm', { loop: true });
    this.bgm.play();

    // Add enemies
    enemies = this.physics.add.group();
    map.getObjectLayer('enemies').objects.forEach(enemy => {
        const e = enemies.create(enemy.x, enemy.y, 'enemy')
            .setVelocityX(100)
            .setCollideWorldBounds(true)
            .setBounceX(1);
        
        this.anims.create({
            key: `enemy-${e.texture.key}-walk`,
            frames: this.anims.generateFrameNumbers('enemy', { start: 0, end: 3 }),
            frameRate: 6,
            repeat: -1
        });
        e.anims.play(`enemy-${e.texture.key}-walk`);
    });

    // Add powerups
    powerups = this.physics.add.group();
    map.getObjectLayer('powerups').objects.forEach(pu => {
        powerups.create(pu.x, pu.y, 'powerup');
    });

    // Add collisions
    this.physics.add.overlap(player, enemies, hitEnemy, null, this);
    this.physics.add.overlap(player, powerups, collectPowerup, null, this);

    // Secret areas
    const secretZones = map.getObjectLayer('secrets').objects;
    secretZones.forEach(zone => {
        const area = this.add.zone(zone.x, zone.y, zone.width, zone.height)
            .setOrigin(0);
        this.physics.add.overlap(player, area, () => {
            coins.createMultiple({ key: 'coin', quantity: 5 });
            this.cameras.main.flash(200, 0, 255, 0);
        });
    });
}

function update() {
    // Update parallax
    this.bg1.tilePositionX = this.cameras.main.scrollX * 0.2;
    this.bg2.tilePositionX = this.cameras.main.scrollX * 0.5;

    // Player movement
    if (cursors.left.isDown) {
        player.setVelocityX(-200);
        player.anims.play('run', true);
        player.flipX = true;
    } else if (cursors.right.isDown) {
        player.setVelocityX(200);
        player.anims.play('run', true);
        player.flipX = false;
    } else {
        player.setVelocityX(0);
        player.anims.stop();
    }

    if (cursors.up.isDown && player.body.touching.down) {
        player.setVelocityY(-500);
    }
}

function collectCoin(player, coin) {
    // Add particles
    const emitter = this.add.particles(coin.x, coin.y, 'coin', {
        speed: { min: -200, max: 200 },
        angle: { min: 0, max: 360 },
        scale: { start: 0.5, end: 0 },
        lifespan: 500,
        quantity: 5
    });
    emitter.explode();
    
    // Coin logic
    coin.disableBody(true, true);
    score += 10;
    document.getElementById('hud').textContent = `Coins: ${score} | Lives: ${'❤'.repeat(lives)}`;
    this.cameras.main.shake(100, 0.01);
}

function hitEnemy(player, enemy) {
    if (!isInvincible) {
        lives = Math.max(0, lives - 1);
        document.getElementById('hud').textContent = 
            `Coins: ${score} | Lives: ${'❤'.repeat(lives)} | Level: ${currentLevel}`;
        this.cameras.main.shake(300, 0.02);
        
        if (lives <= 0) {
            document.getElementById('gameOver').style.display = 'block';
            this.physics.pause();
        }
        
        isInvincible = true;
        player.setTint(0xff0000);
        this.time.delayedCall(2000, () => {
            isInvincible = false;
            player.clearTint();
        });
    }
}

function collectPowerup(player, powerup) {
    powerup.disableBody(true, true);
    isInvincible = true;
    player.setTint(0x00ff00);
    document.getElementById('powerupHud').textContent = 'INVINCIBLE!';
    this.time.delayedCall(5000, () => {
        isInvincible = false;
        player.clearTint();
        document.getElementById('powerupHud').textContent = '';
    });
}

function nextLevel() {
    currentLevel++;
    if (currentLevel > LEVELS.length) {
        // Show victory screen
        return;
    }
    
    this.scene.restart();
    this.load.tilemapTiledJSON('map', LEVELS[currentLevel-1]);
    document.getElementById('hud').textContent = 
        `Coins: ${score} | Lives: ${'❤'.repeat(lives)} | Level: ${currentLevel}`;
}

function startGame() {
    document.getElementById('titleScreen').style.display = 'none';
    game.events.emit('resume');
}

</script>
</body>
</html>