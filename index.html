<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Quest</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crt-effect {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 4px 100%;
            pointer-events: none;
            z-index: 999;
        }

        .title-screen {
            position: absolute;
            text-align: center;
            color: #fff;
            z-index: 1000;
            text-shadow: 4px 4px #000;
        }

        .pixel-button {
            background: #4a4a4a;
            border: 4px solid #2a2a2a;
            color: #fff;
            padding: 15px 30px;
            font-size: 24px;
            margin: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Press Start 2P', cursive;
        }

        .pixel-button:hover {
            background: #6a6a6a;
            transform: scale(1.1);
        }

        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #fff;
            font-size: 24px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border: 4px solid #2a2a2a;
        }
        
        .game-over {
            position: absolute;
            color: #ff0000;
            font-size: 64px;
            text-shadow: 6px 6px #000;
            z-index: 1001;
            display: none;
        }
        
        .powerup-hud {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #ffeb3b;
            font-size: 18px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="game-container">
        <div class="crt-effect"></div>
        <div class="hud" id="hud">Coins: 0 | Lives: ❤❤❤ | Level: 1</div>
        <div class="powerup-hud" id="powerupHud"></div>
        <div class="title-screen" id="titleScreen">
            <h1 style="font-size: 48px; margin-bottom: 40px;">RETRO QUEST</h1>
            <button class="pixel-button" onclick="startGame()">START ADVENTURE</button>
            <p style="margin-top: 30px; font-size: 16px;">Use ← → to move | SPACE to jump</p>
        </div>
        <div class="game-over" id="gameOver">GAME OVER!</div>
    </div>

<script>
// Base64 Encoded Assets
const ASSETS = {
    player: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAh0lEQVRYR+3WQQqAMAwE0fz7L72IFxEktC5mPATGm4R2fFJKmXv3Y0Br7Q1Ya/0DzjkPAVprHwDn3AN47x8A59wDxBg/AHmeH4BSygNQa/0A1Fo/AGOMB2DO+QDMOR+AUsr9B1zX9QJ47x+A4zg+AKVUO8/zBVBK/QBSSm/fHwCJF0h+Zz2UggAAAABJRU5ErkJggg==",
    
    tile: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAbklEQVRIS2NkoDFgpLH5DMM/AIY/ABwdHf8jBwJaEMjIyPgfWwCgBYG0tPR/bAGAFgRSUlL/sQUAWhBISEj8xxYAaEEgLi7+H1sAoAWBmJjYf2wBgBYEoqKi/7EFAFoQiIiI/McWAGhBICws/B9bAKAFAQCUkSUj8Gj34AAAAABJRU5ErkJggg==",
    
    coin: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAoElEQVRYR2NkoDFgpLH5DMM/AIY/AJydnf8jBwJaEMjIyPgfWwCgBYGMjMx/bAGAFgQyMjL/sQUAWhDIyMj8xxYAaEEgKyv7H1sAoAWBnJzcf2wBgBYE8vLy/7EFAFoQKCgo/McWAGhBoKio+B9bAKAFgZKS0n9sAYAWBMrKyv+xBQBaEKioqPzHFgBoQaCqqvofWwCgBQEArKsmI2mhT5MAAAAASUVORK5CYII=",
    
    enemy: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAp0lEQVRYR+2WQQqAMAwF0/z7L72IFxEktC5mPATGTUJ7PimlzL37M6C19gSstZ4Ac84nwJzzCTDnfALMOZ8AKaUnwFrrCbDWegKstZ4A55xPgHPuCeC9fwK8908A7/0TwHv/BPDenwBEBH8AiOAPAETwBwAR/AFABH8AEMEfAETwBwAR/AFABH8AEMEfAETwBwAR/AFABH8AEMEfAETwBwAR/AHwB5h0Iy3ZoSvZAAAAAElFTkSuQmCC",
    
    powerup: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAq0lEQVRIS2NkoDFgpLH5DMM/AIY/AFxdXf8jBwJaEMjIyPgfWwCgBYGMjMx/bAGAFgQyMjL/sQUAWhDIyMj8xxYAaEEgKyv7H1sAoAWBnJzcf2wBgBYE8vLy/7EFAFoQKCgo/McWAGhBoKio+B9bAKAFgZKS0n9sAYAWBMrKyv+xBQBaEKioqPzHFgBoQaCqqvofWwCgBQEArKsmI2mhT5MAAAAASUVORK5CYII=",
    
    bg: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAJ0lEQVRIS2NkoDFgpLH5DMM/AIY/ANzc3P4jBwJaEMjIyPgfWwAAJd4EICWvR5IAAAAASUVORK5CYII="
};

const LEVEL_DATA = {
    layers: [{
        name: "platforms",
        data: [
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
        ],
        width: 20,
        height: 10
    }],
    tilewidth: 32,
    tileheight: 32
};

// Game Configuration
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#1a1a1a',
    parent: 'game-container',
    pixelArt: true,
    scene: {
        preload: preload,
        create: create,
        update: update
    },
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 800 },
            debug: false
        }
    }
};

let game = new Phaser.Game(config);
let player, cursors, coins, enemies;
let score = 0, lives = 3;

function preload() {
    this.load.image('tile', ASSETS.tile);
    this.load.image('coin', ASSETS.coin);
    this.load.image('enemy', ASSETS.enemy);
    this.load.image('powerup', ASSETS.powerup);
    this.load.spritesheet('player', ASSETS.player, {
        frameWidth: 32,
        frameHeight: 32
    });
}

function create() {
    // Create tilemap
    const map = this.make.tilemap({
        data: LEVEL_DATA.layers[0].data,
        tileWidth: LEVEL_DATA.tilewidth,
        tileHeight: LEVEL_DATA.tileheight
    });
    const tiles = map.addTilesetImage('tile');
    const layer = map.createLayer(0, tiles, 0, 0);
    layer.setCollisionBetween(1, 1);

    // Create player
    player = this.physics.add.sprite(100, 450, 'player');
    player.setCollideWorldBounds(true);

    // Create coins
    coins = this.physics.add.group({
        key: 'coin',
        repeat: 5,
        setXY: { x: 100, y: 0, stepX: 100 }
    });

    // Create enemies
    enemies = this.physics.add.group({
        key: 'enemy',
        repeat: 2,
        setXY: { x: 400, y: 300, stepX: 100 }
    });

    // Collisions
    this.physics.add.collider(player, layer);
    this.physics.add.collider(enemies, layer);
    this.physics.add.overlap(player, coins, collectCoin);
    this.physics.add.overlap(player, enemies, hitEnemy);

    // Animations
    this.anims.create({
        key: 'run',
        frames: this.anims.generateFrameNumbers('player', { start: 0, end: 3 }),
        frameRate: 10,
        repeat: -1
    });

    cursors = this.input.keyboard.createCursorKeys();
}

function update() {
    // Update parallax
    this.bg1.tilePositionX = this.cameras.main.scrollX * 0.2;
    this.bg2.tilePositionX = this.cameras.main.scrollX * 0.5;

    // Player movement
    if (cursors.left.isDown) {
        player.setVelocityX(-200);
        player.anims.play('run', true);
        player.flipX = true;
    } else if (cursors.right.isDown) {
        player.setVelocityX(200);
        player.anims.play('run', true);
        player.flipX = false;
    } else {
        player.setVelocityX(0);
        player.anims.stop();
    }

    if (cursors.up.isDown && player.body.touching.down) {
        player.setVelocityY(-500);
    }
}

function collectCoin(player, coin) {
    // Add particles
    const emitter = this.add.particles(coin.x, coin.y, 'coin', {
        speed: { min: -200, max: 200 },
        angle: { min: 0, max: 360 },
        scale: { start: 0.5, end: 0 },
        lifespan: 500,
        quantity: 5
    });
    emitter.explode();
    
    // Coin logic
    coin.disableBody(true, true);
    score += 10;
    document.getElementById('hud').textContent = `Coins: ${score} | Lives: ${'❤'.repeat(lives)}`;
    this.cameras.main.shake(100, 0.01);
}

function hitEnemy(player, enemy) {
    if (!isInvincible) {
        lives = Math.max(0, lives - 1);
        document.getElementById('hud').textContent = 
            `Coins: ${score} | Lives: ${'❤'.repeat(lives)} | Level: ${currentLevel}`;
        this.cameras.main.shake(300, 0.02);
        
        if (lives <= 0) {
            document.getElementById('gameOver').style.display = 'block';
            this.physics.pause();
        }
        
        isInvincible = true;
        player.setTint(0xff0000);
        this.time.delayedCall(2000, () => {
            isInvincible = false;
            player.clearTint();
        });
    }
}

function collectPowerup(player, powerup) {
    powerup.disableBody(true, true);
    isInvincible = true;
    player.setTint(0x00ff00);
    document.getElementById('powerupHud').textContent = 'INVINCIBLE!';
    this.time.delayedCall(5000, () => {
        isInvincible = false;
        player.clearTint();
        document.getElementById('powerupHud').textContent = '';
    });
}

function nextLevel() {
    currentLevel++;
    if (currentLevel > LEVELS.length) {
        // Show victory screen
        return;
    }
    
    this.scene.restart();
    this.load.tilemapTiledJSON('map', LEVELS[currentLevel-1]);
    document.getElementById('hud').textContent = 
        `Coins: ${score} | Lives: ${'❤'.repeat(lives)} | Level: ${currentLevel}`;
}

function startGame() {
    document.getElementById('titleScreen').style.display = 'none';
    game.events.emit('resume');
}

</script>
</body>
</html>
